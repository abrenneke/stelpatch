is_valid_refugee_pop {
    owner = {
        any_relation = {
            has_communications = prev
            NOT = {
                has_policy_flag = refugees_not_allowed
            }

            any_owned_planet = {
                is_controlled_by = owner
                is_under_colonization = no
                has_orbital_bombardment = no
            }

            prevprev = {
                OR = {
                    has_citizenship_type = {
                        type = citizenship_full
                        country = prev
                    }

                    AND = {
                        prev = {
                            has_policy_flag = refugees_allowed
                        }

                        has_citizenship_type = {
                            country = prev
                            type = citizenship_limited
                        }

                    }

                }

            }

            is_country_type = default
        }

    }

    is_robot_pop = no
    NOR = {
        has_trait = trait_hive_mind
        can_think = no
    }

}

